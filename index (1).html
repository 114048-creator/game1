<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>超級瑪利歐迷你版 - 立即玩</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#5c94fc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { margin: 0; overflow: hidden; background: #5c94fc; font-family: Arial, sans-serif; }
        canvas { display: block; background: #5c94fc; margin: 20px auto; border: 4px solid #000; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .ui { position: absolute; top: 10px; left: 10px; color: white; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>
    <div class="ui">
        <h1>超級瑪利歐：迷你模式</h1>
        <p>控制：方向鍵移動 & 跳躍 (↑) | 目標：抵達右側金色區域</p>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = 800;
canvas.height = 400;

const gravity = 0.8;
const friction = 0.8;

const player = {
    x: 50, y: 300,
    width: 32, height: 32,
    speed: 5,
    velX: 0, velY: 0,
    jumping: false,
    color: "#ff0000"
};

const platforms = [
    { x: 0, y: 380, w: 1000, h: 20, color: "#884010" },
    { x: 200, y: 280, w: 100, h: 20, color: "#ffcc00" },
    { x: 400, y: 200, w: 100, h: 20, color: "#ffcc00" },
    { x: 600, y: 280, w: 100, h: 20, color: "#ffcc00" },
    { x: 750, y: 100, w: 50, h: 300, color: "#ffd700" }
];

const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

function update() {
    if (keys['ArrowRight'] || keys['KeyD']) player.velX = Math.min(player.velX + 1, player.speed);
    if (keys['ArrowLeft'] || keys['KeyA']) player.velX = Math.max(player.velX - 1, -player.speed);

    if ((keys['ArrowUp'] || keys['Space']) && !player.jumping) {
        player.velY = -15;
        player.jumping = true;
    }

    player.velX *= friction;
    player.velY += gravity;

    player.x += player.velX;
    player.y += player.velY;

    for (let plat of platforms) {
        if (
            player.x < plat.x + plat.w &&
            player.x + player.width > plat.x &&
            player.y < plat.y + plat.h &&
            player.y + player.height > plat.y
        ) {
            if (player.velY > 0 && player.y + player.height - player.velY <= plat.y) {
                player.jumping = false;
                player.velY = 0;
                player.y = plat.y - player.height;

                if (plat.color === "#ffd700") {
                    alert("恭喜破關！");
                    resetGame();
                }
            }
        }
    }

    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    if (player.y > canvas.height) resetGame();

    draw();
    requestAnimationFrame(update);
}

function resetGame() {
    player.x = 50;
    player.y = 300;
    player.velX = player.velY = 0;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(100, 100, 30, 0, Math.PI * 2);
    ctx.arc(130, 100, 40, 0, Math.PI * 2);
    ctx.arc(160, 100, 30, 0, Math.PI * 2);
    ctx.fill();

    for (let plat of platforms) {
        ctx.fillStyle = plat.color;
        ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
        ctx.strokeStyle = "#000";
        ctx.strokeRect(plat.x, plat.y, plat.w, plat.h);
    }

    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

update();

// 註冊 Service Worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>
